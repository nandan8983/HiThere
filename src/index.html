<!DOCTYPE html>
<html data-bs-theme="light" lang="en">

<head>
    <meta charset="utf-8">
    <!-- <link rel="icon" href="https://i.ibb.co/NVBtKF6/logoforproject.png" /> -->
    <link rel="icon" href="https://i.ibb.co/rHNmRGL/4846450.png"  fill="currentColor"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>HiThere</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

    <style>
        ::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>

<body>
    <div id="loginPage" style="height: 100vh; width: 100%; position: absolute; background-color: #fff; z-index: 1000;">
        <div class="container">
            
            <div class="row d-flex justify-content-center" style="margin-top: 30%;">
                <div class="col-md-6 col-xl-4">
                    <div class="card mb-5">
                        <div class="card-body d-flex flex-column align-items-center">
                            <div class="bs-icon-xl bs-icon-circle bs-icon-primary bs-icon my-4"><h2><svg class="bi bi-person" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 16 16">
                                <path
                                d="M11.176 14.429c-2.665 0-4.826-1.8-4.826-4.018 0-2.22 2.159-4.02 4.824-4.02S16 8.191 16 10.411c0 1.21-.65 2.301-1.666 3.036a.324.324 0 0 0-.12.366l.218.81a.616.616 0 0 1 .029.117.166.166 0 0 1-.162.162.177.177 0 0 1-.092-.03l-1.057-.61a.519.519 0 0 0-.256-.074.509.509 0 0 0-.142.021 5.668 5.668 0 0 1-1.576.22ZM9.064 9.542a.647.647 0 1 0 .557-1 .645.645 0 0 0-.646.647.615.615 0 0 0 .09.353Zm3.232.001a.646.646 0 1 0 .546-1 .645.645 0 0 0-.644.644.627.627 0 0 0 .098.356Z">
                            </path>
                            <path
                                d="M0 6.826c0 1.455.781 2.765 2.001 3.656a.385.385 0 0 1 .143.439l-.161.6-.1.373a.499.499 0 0 0-.032.14.192.192 0 0 0 .193.193c.039 0 .077-.01.111-.029l1.268-.733a.622.622 0 0 1 .308-.088c.058 0 .116.009.171.025a6.83 6.83 0 0 0 1.625.26 4.45 4.45 0 0 1-.177-1.251c0-2.936 2.785-5.02 5.824-5.02.05 0 .1 0 .15.002C10.587 3.429 8.392 2 5.796 2 2.596 2 0 4.16 0 6.826Zm4.632-1.555a.77.77 0 1 1-1.54 0 .77.77 0 0 1 1.54 0Zm3.875 0a.77.77 0 1 1-1.54 0 .77.77 0 0 1 1.54 0Z">
                            </path>
                                </svg>
                                <span>HiThere</span></h2>
                            </div>
                            <form class="text-center" id="inputName" action="">
                                <div class=""><input class="form-control" type="text" name="email" placeholder="Enter Username To Join" id="nameInput"/></div>
                                <!-- <div class="mb-3"><input class="form-control" type="password" name="password" placeholder="Password" /></div> -->
                                <span id="loginError" style="color: red;"></span>
                                <div class="mb-3 mt-3"><button class="btn btn-primary d-block w-100" type="submit" >Join Chat</button></div>
                                <p class="text" style="cursor: pointer;" id="guest">Join As Guest</p>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div style="height: 99vh; width: 100%;">
    <nav class="navbar navbar-expand-md py-3 navbar-light" >
        <div class="container">
            <p class="navbar-brand d-flex align-items-center" style="margin-left: 9px;">
                <span
                    class="bs-icon-sm bs-icon-rounded bs-icon-primary d-flex justify-content-center align-items-center me-2 bs-icon"><svg
                        xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor"
                        viewBox="0 0 16 16" class="bi bi-wechat">
                        <path
                            d="M11.176 14.429c-2.665 0-4.826-1.8-4.826-4.018 0-2.22 2.159-4.02 4.824-4.02S16 8.191 16 10.411c0 1.21-.65 2.301-1.666 3.036a.324.324 0 0 0-.12.366l.218.81a.616.616 0 0 1 .029.117.166.166 0 0 1-.162.162.177.177 0 0 1-.092-.03l-1.057-.61a.519.519 0 0 0-.256-.074.509.509 0 0 0-.142.021 5.668 5.668 0 0 1-1.576.22ZM9.064 9.542a.647.647 0 1 0 .557-1 .645.645 0 0 0-.646.647.615.615 0 0 0 .09.353Zm3.232.001a.646.646 0 1 0 .546-1 .645.645 0 0 0-.644.644.627.627 0 0 0 .098.356Z">
                        </path>
                        <path
                            d="M0 6.826c0 1.455.781 2.765 2.001 3.656a.385.385 0 0 1 .143.439l-.161.6-.1.373a.499.499 0 0 0-.032.14.192.192 0 0 0 .193.193c.039 0 .077-.01.111-.029l1.268-.733a.622.622 0 0 1 .308-.088c.058 0 .116.009.171.025a6.83 6.83 0 0 0 1.625.26 4.45 4.45 0 0 1-.177-1.251c0-2.936 2.785-5.02 5.824-5.02.05 0 .1 0 .15.002C10.587 3.429 8.392 2 5.796 2 2.596 2 0 4.16 0 6.826Zm4.632-1.555a.77.77 0 1 1-1.54 0 .77.77 0 0 1 1.54 0Zm3.875 0a.77.77 0 1 1-1.54 0 .77.77 0 0 1 1.54 0Z">
                        </path>
                    </svg>
                </span>
                    <span>HiThere</span>
                </p>
                    
                    <span class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navcol-4" style="border: 0;">
                        <span class="visually-hidden">Toggle navigation</span>
                        <svg class="bi bi-list" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z"></path>
                        </svg>
                        <!-- <span class="navbar-toggler-icon"></span> -->
                    </span>

                    <div id="navcol-4" class="collapse navbar-collapse flex-grow-0">
                        <button class="dropdown mr-5 btn bg-light me-2"><span class="dropdown-toggle" aria-expanded="false" data-bs-toggle="dropdown" href="#">Online Users </span>
                            <div class="dropdown-menu" id="usersList">
                                <span class="dropdown-item">Users List</span>
                                
                            </div>
                        </button>
                        <button class="btn btn-light me-2" type="button" id="logout">Logout</button>
                    </div>
                  


                    
                </div>
    </nav>

    <section class="py-4 py-xl-5" style="height: 80vh;padding-bottom: 0px;padding-top: 17px;">
        <div class="container position-relative">
            <div class="row d-flex justify-content-center">
                <div class="col-md-8 col-lg-5 col-xl-5 col-xxl-4" style="height: 83vh;">
                    <div class="card mb-5" style="padding-bottom: 0px;margin-bottom: 61px;">
                        <div class="card-body d-block float-end" style="height: 82vh;">
                            <div id="chat" style="overflow: scroll; height: 85%;background: rgba(232,232,232,0);">
                                <ul  id="messages" style="position: sticky;padding-left: 0px;">
                                    
                                </ul>
                                <p id="userTyping" style="font-size: 12px; position: absolute; bottom: 15%; "></p>
                            </div>
                       
                            <form id="form" action="">
                                
                                <div style="height: 15%;">
                                    <select class="form-select" style="width: 99%;margin-bottom: 10px;" id="userSelect" >
                                        <optgroup label="Select to send massage" id="users">
                                            <option selected="">Everyone</option>
                                        </optgroup>
                                    </select>
                                    <input id="input"  autocomplete="off" class="form-control" type="text" name="text"
                                        placeholder="Type massage"
                                        style="position: relative;display: inline;width: 74%;">
                                        <button
                                        class="btn btn-primary" type="submit"
                                        style="display: inline-block;position: relative;width: 21%;margin-left: 8px;margin-top: 0px;">Send
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    </div>
    <script src="/socket.io/socket.io.js"></script>

    <script >



var name , id;
var socket = io();
var messages = document.getElementById('messages');
var userslist = document.getElementById('users');
var form = document.getElementById('form');
var input = document.getElementById('input');
var userSelect = document.getElementById('userSelect');
var ChatDiv = document.getElementById('chat');
var onlineList = document.getElementById('usersList');
var userTyping = document.getElementById('userTyping');
var inputName = document.getElementById('inputName');
var nameInput = document.getElementById('nameInput');
var guest = document.getElementById('guest');
var loginPage = document.getElementById('loginPage');
var loginError = document.getElementById('loginError');
var logout = document.getElementById('logout');
/*
let person = prompt("Please enter your name:");
if (person == null || person == "") {
    alert(' Enter your name or Try another name.');
    location.reload();
}else if(person.replace(" ","").length < 3){
    alert(' Enter your name or Try another name.');
    location.reload();
} 
else {
  name = person;
}*/
//socket.emit('name', name);
inputName.addEventListener('submit', function(e) {
    e.preventDefault();
    if (nameInput.value == null || nameInput.value == "") {
        loginError.textContent = "Please enter your name";
        nameInput.value = "";
    }else if(nameInput.value.replace(" ","").length < 3){
        loginError.textContent = "Please enter valid name";
        nameInput.value = "";
    } 
    else {
        name = nameInput.value;
        socket.emit('name', name);
        loginPage.style.display = "none";
    }
});


guest.addEventListener('click', function(e) {
    e.preventDefault();

    name = "Guest";
    socket.emit('name', name);
    loginPage.style.display = "none";
});


socket.on('user exists', function(userName) {
    alert(userName + ' already in use. Try another name.');
    location.reload();
});

input.addEventListener('input', function(e) {
    socket.emit('typing', name);
});

socket.on('typing', function(name) {
    userTyping.textContent = name.name + " is typing...";
    setTimeout(() => {
        userTyping.textContent = "";
    }, 1000);
});
socket.on('chat message', function(obj) {
    if(obj.name == name && obj.id == id){
        let item = document.createElement('li');
        item.textContent = "You : "+  obj.msg;
        item.style = "background: var(--bs-link-color);color: #ffffff;font-size: 14px;border-style: none;border-radius: 6px;padding: 10px;margin-left: 90px; list-style-type: none; margin-top: 10px;";
        messages.appendChild(item);
        window.scrollTo(0, document.body.scrollHeight);
        ChatDiv.scrollTop = ChatDiv.scrollHeight;
    }else{
    let item = document.createElement('li');
    item.textContent = obj.name +" : "+  obj.msg;
    item.style = "background: #d8dce1;color: #000000;font-size: 14px;border-style: none;border-radius: 6px;padding: 10px;margin-right: 90px; list-style-type: none; margin-top: 10px;";
    messages.appendChild(item);
    window.scrollTo(0, document.body.scrollHeight);
    }
    ChatDiv.scrollTop = ChatDiv.scrollHeight;
});

socket.on('private chat message', function(obj) {
    if(obj.name == name && obj.id == id){
        let item = document.createElement('li');
        let item1 = document.createElement('li');
        item.textContent = "You : "+  obj.msg;
        item.style = "background: var(--bs-link-color);color: var(--bs-body-bg);font-size: 14px;border-style: none;border-radius: 6px;padding: 10px;margin-left: 90px; list-style-type: none; margin-top: 10px;";
        item1.textContent = "massage to "+userSelect.value;
        item1.style = "font-size: 11px; text-align: end; color: #a10000;";
        messages.appendChild(item);
        messages.appendChild(item1);
        window.scrollTo(0, document.body.scrollHeight);
        ChatDiv.scrollTop = ChatDiv.scrollHeight;
    }else{
    let item = document.createElement('li');
    let item1 = document.createElement('li');
    item.textContent = obj.name +" : "+  obj.msg;
    item.style = "background: #d8dce1;color: var(--bs-emphasis-color);font-size: 14px;border-style: none;border-radius: 6px;padding: 10px;margin-right: 90px; list-style-type: none; margin-top: 10px;";
    item1.textContent = "massage from "+obj.name;
    item1.style = "font-size: 11px; text-align: start; color: #a10000;";
    messages.appendChild(item);
    messages.appendChild(item1);
    window.scrollTo(0, document.body.scrollHeight);
    }
    ChatDiv.scrollTop = ChatDiv.scrollHeight;
});

socket.on('hi', function(obj) {
    name = obj.name;
    id = obj.id;
    let item = document.createElement('li');
    item.textContent = "Hi Welcome To HiThere "+name;
    item.style = "color:#999999; font-size:12px; text-align: center; list-style-type: none;";
    messages.appendChild(item);
    window.scrollTo(0, document.body.scrollHeight);
    
});

socket.on('join lobby', function(obj) {
    let item = document.createElement('li');
    item.textContent = obj+" joined the chat room";
    item.style = "color:#999999; font-size:12px; text-align: center; list-style-type: none;";
    messages.appendChild(item);
    window.scrollTo(0, document.body.scrollHeight);
});

socket.on('leave lobby', function(name) {
    let item = document.createElement('li');
    item.textContent = name+" leave the chat room";
    item.style = "color:#999999; font-size:12px; text-align: center; list-style-type: none;";
    messages.appendChild(item);
    window.scrollTo(0, document.body.scrollHeight);
});

socket.on('users', function(users) { 
    userslist.innerHTML = "";
    userslist.innerHTML = "<option value='Ev' selected=''>Everyone</option>";
    onlineList.innerHTML = "";
    onlineList.innerHTML = `<span class='dropdown-item'>You (${name}) </span>`;

    
    users.splice(users.indexOf(name),1);
    users.map((user,index)=>{
        let item = document.createElement('option');
        let item1 = document.createElement('span');
        item.textContent = user;
        item1.textContent =  user;
        item1.className = "dropdown-item";
        userslist.appendChild(item);
        onlineList.appendChild(item1);
    })
});

socket.on('some event', (msg)=>{
    console.log(msg);
});

form.addEventListener('submit', function(e) {
    e.preventDefault();
    if (input.value && userSelect.value == "Ev") {
        socket.emit('chat message', input.value);
        input.value = '';
    }else if(input.value && userSelect.value != "Ev"){
        socket.emit('private message', {msg: input.value, user: userSelect.value});
        input.value = '';
    }
    });

    logout.addEventListener('click', function(e) {
        e.preventDefault();
        location.reload();
    });

   /* document.addEventListener("contextmenu", function (e){
        e.preventDefault();
    }, false);
     */  
      </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>

</html>